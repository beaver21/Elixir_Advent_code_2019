defmodule Day3 do

  def remove_unecessary_row(input, %{y: y}) do
    Enum.take_every(input, y)
  end

  def read_infinite_row(row, index) do
    stream = Stream.cycle(String.split(row, "", trim: true))

    Enum.at(stream, index)
  end

  def count_trees_encounter(input, slope = %{x: x}) do
    {_, trees} =
      input
      |> remove_unecessary_row(slope)
      |> Enum.reduce({0,0}, fn row, {current_x, trees} ->
          is_tree = case read_infinite_row(row, current_x) do
            "#" -> 1
            _ -> 0
          end

          {current_x + x, trees + is_tree}
      end)

      trees
  end

  def slope(v_x, v_y) do
    {_, trees} =
      input()
      |> Enum.take_every(v_y)
      |> Enum.map(&String.to_charlist/1)
      |> Enum.reduce({0, 0}, fn row, {x, trees} ->
        trees =
          case Stream.cycle(row) |> Enum.at(x) do
            ?# -> trees + 1
            ?. -> trees
          end

        {x + v_x, trees}
      end)

    trees
  end

  def multiply_all_trees() do
    [
      %{x: 1, y: 1},
      %{x: 3, y: 1},
      %{x: 5, y: 1},
      %{x: 7, y: 1},
      %{x: 1, y: 2},
    ]
    |> Enum.map(fn slope ->
      IO.puts(count_trees_encounter(input(), slope))
      count_trees_encounter(input(), slope)
    end)
    |> Enum.reduce(& &1 * &2)
  end

  def input() do
    [
"....#...##......##..#..#.#...#.",
"..######...#......#....#..#.##.",
"..#.#...##......#.#..#..#....#.",
"..#.....#..#.#........#.#..#..#",
"#......##..###...#.#..#.....#..",
"#.......##...###...#....#......",
".....##...#......##.#.#..#.##..",
".........#......#.....#......#.",
"..#.#..#....#....#......##.#.##",
".#...#..#.............#.#..#.#.",
"....#..#.#.##.#....#..#..#....#",
"...#..#.....#.......#...#..#..#",
".....#.....#.......#..#...#....",
".##.......#...#..#........#...#",
"...#.......#.#.#...#.#.#......#",
"#....#..#.....#......##....#..#",
"###.#......#.#.#.#..#....#....#",
"......##......#.#...#...#..#...",
".....#......#.#.#......#.#.....",
"...##...#..#........#..#.##....",
"..##.#.#..#...###..........#.#.",
".#..#..#.....#.........#.###.#.",
"....##.....#...#...##..#.##...#",
"....#.##....#.....##......#....",
"........#.#.........#.#.......#",
"#....##.#....#..#...#..........",
"#..###......#....##..........##",
"....##.#.....#..#.##......#....",
"#..#......#......#.............",
"...##.....##.......#.......#...",
"#...#.#.....#..........#...###.",
"#.....#..#.#.###...#......###..",
"...##.#......#........#..#.....",
"......#.....###.#...##........#",
".#......##......##....#....#...",
"..#.#..#.....##....#....#..#...",
"..#.#.....#.##.#.....#.....#...",
"....#.......#...#.........##...",
".#....#..#.......##.......#....",
"..#..##.....#...##.##.#.#......",
".##.#....#............#.......#",
".......#...#..#.#.##.....##..##",
"..###....#..#.##........##.#...",
"....#.#..#.....#..#.#.....#....",
"..#..#.#..............#..#.....",
".......#.#.#.........#......#..",
"...##..#.#...#......##.#.......",
"#....#.#.........#...#....#..##",
".#..#.#...#.......#.#.#....#.##",
".#..###.#..#.#.....#..#........",
"#.#..##.###.....##.........#..#",
"#...##...#..##..#..#..........#",
".#...#..#......................",
"...##..###...........#.#...##..",
"..........#.#....#.#...........",
"..#....#....#..#....#.#.#......",
".#..#.....###......#...#...#...",
"#.##..#..#.........#..#....#...",
"........#......#...#.........#.",
"..#.....#.#..##...#.#.#...##...",
"..#...........#.##..#.#..#.##..",
"..............##...#.#......#..",
"#.#..#....#...##.###........#..",
".#...#..#........#........##..#",
".....##..#...#.....#.#.........",
".#...#...#....###...#.#.#..##..",
"....#.........#....###..##....#",
".#....#...####...##....####.#..",
"..#..#.......#..#......#.#.#...",
"....#....#.......##..#.#.......",
"..#....#...........##.#.##.....",
"#..#..#...##.##....#.#.#.###.##",
"...#...#....#.#...##...#....###",
"......##........#.........#.#..",
"....#####..#..##.......#.#....#",
"....##..#...###....#..#.....#..",
"..#........#..#.#.....#....#...",
"..#....#......#..#...#......#..",
"...#.....##...#.#..##.....#..#.",
"...#..#.......####.##...#......",
".....#..#..#.##..##....#..#.#..",
"..#..#..##.#.#.##..#..#...#....",
"...#..........#.........#....##",
".##.....###...............#.##.",
"...##...........#.#.#......#..#",
".#...#.#.##....#....#..#.......",
".#...###.#....#..#..#..#......#",
"#..#........###...........#..#.",
"..#...#......#.#.#......####.#.",
"...#.#....##.#.....#.....##....",
"...###..#.#.#...#.....#.###..#.",
".#.#..#...##......#..........#.",
"##.....#.......#.#..###...#.#..",
"##.###....#.....#.....###.#....",
"#...#..##....#.#...#...#......#",
".....##.#........#.###.........",
".#..#..#.#......##.#...#.#.....",
"#..#.#........##...........##.#",
"#...###..#..####..#.#..........",
"..#...#....#...##.#....#....##.",
"......#.#........#.....#..#....",
"#.........#...#.....#...#..##..",
"#....#.........#...#.##..###.#.",
"#...###...#.##.#.#.............",
"#.#....#....#......#....#.#...#",
"##...#.##......#..#.#....#.....",
"....#...#.##....#..............",
".........##..........#..##..#..",
"......##....#.#......#.........",
"..#.#..............#......#..##",
"...........##.......#.#.#......",
"##...#........##.......#.#.....",
"....#...#...#....#.#......##...",
"...#..#.#.#.........#..#.#....#",
".##.#...#.#.........#.....##.#.",
"#.#.....#.#.....#..............",
"..#.#..#....#..........#..##...",
"...#..#....................#..#",
"...........#...........#...#..#",
"............#...#............##",
"..#....##......##...........#..",
"..#..#..#....#....##......##.##",
"##..........#..##.##.#...#.....",
"............#..#........###.#..",
"###...##.#.#....#....#.#....#..",
"...#......##...#.......####....",
".......#..#..#.#.....#.........",
"........##.......##.....#......",
"#.#...#.###....#..#...##.......",
"...#.#....#..#####.#..##.#.....",
"..#.#..##.......###...#.....#..",
"..#.......#..#...#...#..#.##...",
"......#..#.......#.....#....#..",
".......#........#.#.......##..#",
".#.#.....#.......#.......##..#.",
"..#.#....#.#.#####.....#...#...",
"#..#............###.......#..#.",
"........##.........#..#...###..",
".#............##...#.....#.....",
".#..##..#....#....#.......#....",
"....##..........##.............",
".##..........#..#..#....#...#..",
"...#..#..#............####.....",
".............#..#.##..#.#.##...",
".....#........#....#.#.......#.",
"###.#..#.#...#....##...........",
"....#......#...#....##.......#.",
".......#.#...#.#...#........##.",
"..........#........#..#.##.....",
"##..#.#.....##.#...............",
".....#....#................#...",
"...##....#........##.#....#....",
".....##...###....#.#..#.......#",
".....#.#.........##....###.....",
".#.....##......#..##..##...##.#",
".#..............#.....#.#......",
".##......#..#..#......##.......",
".......#..................#....",
"...#.#...##......####.........#",
"#....#####.#.#..#..#..#...#...#",
"##.#...#.......#....#...#...###",
"...#........#.....#...#.##.....",
"..##....#.......#....#.......##",
"#......#..##...#..##.#.....#.#.",
"..###........#.#..#........#.#.",
"...#.###..........#.....#.#.#..",
"#.###.....#...#...#..##..###...",
"#....#.#.....#.#........#......",
"........#.......##.......#.....",
"...........#...#......##.......",
"............#...#....#..#.....#",
"#.#.#.#....#.....#.#..........#",
"#.##...#...#..#....##.#.......#",
"...#..#......#..#...##..##..#..",
"#....#......#.#.....##.#..#....",
"#....#..##.#......#.#.....#..##",
".#..##....##....#.#...#...#....",
"#.#.###....#.#............#...#",
".#.#....#..#..........#....#.#.",
"......#..#.#...............##..",
"..#......###.#..........#.###..",
"....#.##.#..#...##..#.#...#....",
"..............#...##.......#.##",
".#...........#....#....#.##....",
"#..#....#.....#...#.....##...#.",
".........#...#.##.......#...#.#",
".....#......#.........#.#..#...",
"##..........#.#..##...#.#.#....",
"##..##.#..#..#.....#.##....#...",
"........##....#.#.#....#......#",
".#.##...#.###....#.........#..#",
"..........#....###..#.........#",
"#.#..#.#...#.......#..##.......",
"..#....#...###..............##.",
"#..###.....####...#..#..#...#..",
"......#..#...###........###....",
"..#.....#...#.......#....###..#",
".#.........#.#.#....#.#.......#",
"#.#.###.#.#...........#........",
"......#..#.........#........#..",
"...........##.#........#.#...#.",
".....#.#......##.......#.....##",
"...##...#............#..#.....#",
".....#..##....##...##.#..#.#...",
"...#...#........#.#......##....",
"........#..##..#..#......##.#..",
".#.#.....#.....#...........#.##",
".#...#.#............#......#...",
".....#...#........#....#..#.#..",
"...##....#..#...#..............",
"#....##.#.#............#.......",
"#..#..#.....##..#........##.#.#",
"##..#.#....#....##.......###..#",
".#.#.#.....###.....#.#......###",
".....#..#...###...#....#.#...#.",
".##.....................##....#",
".#.....#.........#....#.....##.",
"#...#....#.#...###.......#.#..#",
"...#.................#.#....#.#",
".##...#.#......................",
".##.#........#...##............",
".#....#.....#.........#.##..##.",
"#......#...##..#.........##.##.",
"......#......#...####..#.##....",
".###....#..##......#.##......#.",
"..#...#....#..#.......#.#......",
"#....#...#.................#.#.",
"....#.#.#..#...#..#.......#.#.#",
"#.#...##.......#.....##.#......",
"#.........#.....##..##..#......",
"....#..##..#.....#..#..#.#..#..",
"......#.#..#.#.#....#.#.......#",
".##......#..#....##...##..#....",
"..#..#......#...##..#.##.....#.",
"..#..#.......#.#....#.....#...#",
"....#.#.....###...#.......#.#..",
"..#....##.....##.#........##...",
"#...............##....#.....##.",
".#.........#....#...##.###.##.#",
".#.##..#.............#.#.#..#..",
".#.....#.................##....",
"..####.........#.#......#.#..#.",
"#.......#..........#.#........#",
".#.#...##.....#.#.......#....#.",
"..#.##.#.......###....#....#...",
".#....##.............##.#.#.#..",
"#.#.....#.#.#.#..#......##..#..",
".............#..........#.#.#..",
"...#.#.............#.#...##....",
".......#..#.#.......#..#.#....#",
".............#.........###..#..",
".#.#..#....#.....#..#.....#...#",
"#.....#....##..##.#..#........#",
"..##..###.....##....#.#..#.....",
"..#...##....#...#.#..........#.",
"...##..##.#.....#....#.........",
"..#...#........##.#..#........#",
"#.............#.###......#.##..",
".#...#........#...........#...#",
"..##.......#.#..##.##......#...",
"...#.#...##....##..#...........",
".#......##........#....##....#.",
".........#..#....#...#..##.##..",
"....#..#.#...#.......#.#.##....",
"...#.#......#.#..#..#.#....#..#",
".......#........#.........###..",
"#.#..#.#.........##............",
"##..##..#.##..###...#.#...#....",
".#....#.#..#...#....#.##.....#.",
".#.#.#.#........##...#..#.#.##.",
".#..#.#..#...........#..#......",
"..#.##.#...#....#.........#...#",
".....##...#.#...#...#....#.....",
"..#..........#.#.#.......##.#..",
"#.#............#..#.....#..#...",
"..#...........##.#.##.#....#..#",
"#..####.....#............#.....",
".##......#####.#..#.....#....#.",
"...##..#.#......#.#..#..#...##.",
"#....................#.##...#.#",
"...#............#.............#",
"....#.##..........#.....#......",
"....##..##....#.#..............",
"...........#....##.#.....#.....",
"....#.....#....#....#......#...",
"#...##........#...#........#.#.",
"........#.....##..#.##.#..#.#.#",
"....##......##....#.....##....#",
"...#.#........##.......#...##..",
"#......##..#.#.#....##......#..",
"..#.......#.......##..#.##.....",
".#...#...#.#.............##....",
"......#.#.#.........##...#..#.#",
".....#..####....#.##..........#",
"...#...#.#....#.....#..#.....##",
".........#.......#......###....",
"........##..##..#.#.#...###...#",
".#..##.#....#...##.....#.#.#...",
"........##...#...##..#.........",
".........#.......#.##..#...####",
"#......#.....#..............#.#",
"##..##.#.##.....##...........#.",
"#.............#.........#......",
"...####.#.##..#.#.#.##.#......#",
"..#.....##....#...#............",
"#..............#......#...###..",
"..#..#.#...#.##.........##.....",
"..#...##..#........#..#.##..##.",
"......###...#..#....#..#.###...",
"...##.##.###.....##.#.......#..",
"#....#..###..#.......#.#.#..#..",
"..##.............##..##...###.#",
".#.#..#.........#..........#...",
".........#.#.....##...#..#...##",
"....#..#....#####..#...#..#....",
"...#.....#.....#...#.#..#.#....",
".#..#.............#.......##.#.",
"...##.......#.#.....##......#..",
"...........##..#.##..###...#.#.",
"...........#...........#...#..#",
"..#....#.##.#..#..#...........#",
"..#.....##...#......#...#......",
"...###.###.....##..........#..#",
    ]
  end

end
